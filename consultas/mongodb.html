<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Consultas MongoDB - Sistema de Acompanhamento de Dietas</title>
  <meta name="description" content="Sistema NoSQL para nutricionistas acompanharem a dieta dos seus pacientes, utilizando Neo4j (banco de grafos) e MongoDB (banco de documentos).">
  <link rel="stylesheet" href="/sistema-acompanhamento-dietas/assets/css/style.css">
  <link type="application/atom+xml" rel="alternate" href="/sistema-acompanhamento-dietas/feed.xml" title="Sistema de Acompanhamento de Dietas" />
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Consultas MongoDB | Sistema de Acompanhamento de Dietas</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Consultas MongoDB" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Sistema NoSQL para nutricionistas acompanharem a dieta dos seus pacientes, utilizando Neo4j (banco de grafos) e MongoDB (banco de documentos)." />
<meta property="og:description" content="Sistema NoSQL para nutricionistas acompanharem a dieta dos seus pacientes, utilizando Neo4j (banco de grafos) e MongoDB (banco de documentos)." />
<link rel="canonical" href="/sistema-acompanhamento-dietas/consultas/mongodb.html" />
<meta property="og:url" content="/sistema-acompanhamento-dietas/consultas/mongodb.html" />
<meta property="og:site_name" content="Sistema de Acompanhamento de Dietas" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Consultas MongoDB" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Sistema NoSQL para nutricionistas acompanharem a dieta dos seus pacientes, utilizando Neo4j (banco de grafos) e MongoDB (banco de documentos).","headline":"Consultas MongoDB","url":"/sistema-acompanhamento-dietas/consultas/mongodb.html"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>
  <header class="site-header">
    <div class="wrapper">
      <a class="site-title" href="/sistema-acompanhamento-dietas/">Sistema de Acompanhamento de Dietas</a>
      <nav class="site-nav">
        <div class="trigger">
          <a class="page-link" href="/sistema-acompanhamento-dietas/">Início</a>
          <a class="page-link" href="/sistema-acompanhamento-dietas/modelagem/grafos">Modelo de Grafos</a>
          <a class="page-link" href="/sistema-acompanhamento-dietas/modelagem/documentos">Modelo de Documentos</a>
          <a class="page-link" href="/sistema-acompanhamento-dietas/consultas/neo4j">Consultas Neo4j</a>
          <a class="page-link" href="/sistema-acompanhamento-dietas/consultas/mongodb">Consultas MongoDB</a>
        </div>
      </nav>
    </div>
  </header>

  <main class="page-content" aria-label="Content">
    <div class="wrapper">
      <article class="post">
  <header class="post-header">
    <h1 class="post-title">Consultas MongoDB</h1>
  </header>

  <div class="post-content">
    <h1 id="consultas-mongodb">Consultas MongoDB</h1>

<p>Nesta seção, apresentamos as consultas implementadas no MongoDB. Cada consulta é descrita com seu objetivo, o código em JavaScript e uma explicação de como a consulta funciona.</p>

<h2 id="1-encontrar-todos-os-pacientes-de-um-nutricionista-específico">1. Encontrar todos os pacientes de um nutricionista específico</h2>

<p><strong>Objetivo</strong>: Listar todos os pacientes atendidos por um determinado nutricionista.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">patients</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
    <span class="p">{</span><span class="na">nutricionista_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    <span class="p">{</span><span class="na">nome</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">idade</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">objetivo</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">_id</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<p><strong>Explicação</strong>: Esta consulta busca todos os documentos na coleção <code class="language-plaintext highlighter-rouge">patients</code> onde o campo <code class="language-plaintext highlighter-rouge">nutricionista_id</code> é igual a 1. O segundo parâmetro especifica os campos a serem retornados (<code class="language-plaintext highlighter-rouge">nome</code>, <code class="language-plaintext highlighter-rouge">idade</code>, e <code class="language-plaintext highlighter-rouge">objetivo</code>), excluindo o <code class="language-plaintext highlighter-rouge">_id</code>.</p>

<p><strong>Resultado</strong>: <a href="../resultados/mongo_consulta_1.png">Veja a imagem do resultado</a></p>

<h2 id="2-buscar-todas-as-refeições-de-um-paciente-em-um-período-específico">2. Buscar todas as refeições de um paciente em um período específico</h2>

<p><strong>Objetivo</strong>: Listar todas as refeições de um paciente em um intervalo de datas específico.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">meals</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="na">paciente_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">$gte</span><span class="p">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="dl">"</span><span class="s2">2023-10-18</span><span class="dl">"</span><span class="p">),</span>
            <span class="na">$lte</span><span class="p">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="dl">"</span><span class="s2">2023-10-19</span><span class="dl">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="na">tipo</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">data</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">hora</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">calorias</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">adesao</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">_id</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="p">).</span><span class="nx">sort</span><span class="p">({</span><span class="na">data</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">hora</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</code></pre></div></div>

<p><strong>Explicação</strong>: Esta consulta busca documentos na coleção <code class="language-plaintext highlighter-rouge">meals</code> onde o <code class="language-plaintext highlighter-rouge">paciente_id</code> é 1 e a data está entre 18/10/2023 e 19/10/2023. Retorna os campos especificados e ordena os resultados por data e hora.</p>

<p><strong>Resultado</strong>: <a href="../resultados/mongo_consulta_2.png">Veja a imagem do resultado</a></p>

<h2 id="3-calcular-total-de-calorias-consumidas-por-dia">3. Calcular total de calorias consumidas por dia</h2>

<p><strong>Objetivo</strong>: Calcular o total de calorias consumidas por um paciente, agrupadas por dia.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">meals</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="na">$match</span><span class="p">:</span> <span class="p">{</span><span class="na">paciente_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
    <span class="p">{</span>
        <span class="na">$group</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">_id</span><span class="p">:</span> <span class="p">{</span><span class="na">$dateToString</span><span class="p">:</span> <span class="p">{</span><span class="na">format</span><span class="p">:</span> <span class="dl">"</span><span class="s2">%Y-%m-%d</span><span class="dl">"</span><span class="p">,</span> <span class="na">date</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$data</span><span class="dl">"</span><span class="p">}},</span>
            <span class="na">totalCalorias</span><span class="p">:</span> <span class="p">{</span><span class="na">$sum</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$calorias</span><span class="dl">"</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="na">$sort</span><span class="p">:</span> <span class="p">{</span><span class="na">_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
<span class="p">])</span>
</code></pre></div></div>

<p><strong>Explicação</strong>: Esta consulta usa o framework de agregação do MongoDB para:</p>
<ol>
  <li>Filtrar refeições do paciente com ID 1</li>
  <li>Agrupar os resultados por data (convertida para formato YYYY-MM-DD)</li>
  <li>Calcular a soma das calorias para cada dia</li>
  <li>Ordenar os resultados por data</li>
</ol>

<p><strong>Resultado</strong>: <a href="../resultados/mongo_consulta_3.png">Veja a imagem do resultado</a></p>

<h2 id="4-encontrar-receitas-adequadas-para-pacientes-com-restrições">4. Encontrar receitas adequadas para pacientes com restrições</h2>

<p><strong>Objetivo</strong>: Identificar receitas recomendadas em planos alimentares para pacientes com restrições específicas.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">patients</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="na">$match</span><span class="p">:</span> <span class="p">{</span><span class="na">restricoes</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Glúten</span><span class="dl">"</span><span class="p">}},</span>
    <span class="p">{</span>
        <span class="na">$lookup</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">from</span><span class="p">:</span> <span class="dl">"</span><span class="s2">dietPlans</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">localField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">foreignField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">paciente_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">as</span><span class="p">:</span> <span class="dl">"</span><span class="s2">planos</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="na">$unwind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$planos</span><span class="dl">"</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="na">$lookup</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">from</span><span class="p">:</span> <span class="dl">"</span><span class="s2">recipes</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">localField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">planos.receitas_recomendadas</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">foreignField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">as</span><span class="p">:</span> <span class="dl">"</span><span class="s2">receitas</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="na">$unwind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$receitas</span><span class="dl">"</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="na">$project</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">paciente</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$nome</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">receita</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$receitas.nome</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">calorias</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$receitas.calorias</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">_id</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">])</span>
</code></pre></div></div>

<p><strong>Explicação</strong>: Esta consulta complexa usa o framework de agregação para:</p>
<ol>
  <li>Encontrar pacientes com restrição de “Glúten”</li>
  <li>Juntar os dados com a coleção <code class="language-plaintext highlighter-rouge">dietPlans</code> para encontrar os planos alimentares desses pacientes</li>
  <li>Desempacotar o array de planos</li>
  <li>Juntar com a coleção <code class="language-plaintext highlighter-rouge">recipes</code> para encontrar as receitas recomendadas</li>
  <li>Desempacotar o array de receitas</li>
  <li>Projetar apenas os campos desejados</li>
</ol>

<p><strong>Resultado</strong>: <a href="../resultados/mongo_consulta_4.png">Veja a imagem do resultado</a></p>

<h2 id="5-identificar-pacientes-com-baixa-adesão-ao-plano-alimentar">5. Identificar pacientes com baixa adesão ao plano alimentar</h2>

<p><strong>Objetivo</strong>: Encontrar pacientes que têm baixa adesão (menos de 80%) ao plano alimentar.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">meals</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
    <span class="p">{</span>
        <span class="na">$group</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">_id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$paciente_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">totalRefeicoes</span><span class="p">:</span> <span class="p">{</span><span class="na">$sum</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="na">refeicoesCompletas</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">$sum</span><span class="p">:</span> <span class="p">{</span><span class="na">$cond</span><span class="p">:</span> <span class="p">[{</span><span class="na">$eq</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">$adesao</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Completa</span><span class="dl">"</span><span class="p">]},</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="na">$project</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">paciente_id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">totalRefeicoes</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="na">refeicoesCompletas</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="na">taxaAdesao</span><span class="p">:</span> <span class="p">{</span><span class="na">$divide</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">$refeicoesCompletas</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">$totalRefeicoes</span><span class="dl">"</span><span class="p">]},</span>
            <span class="na">_id</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="na">$match</span><span class="p">:</span> <span class="p">{</span><span class="na">taxaAdesao</span><span class="p">:</span> <span class="p">{</span><span class="na">$lt</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">}}},</span>
    <span class="p">{</span>
        <span class="na">$lookup</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">from</span><span class="p">:</span> <span class="dl">"</span><span class="s2">patients</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">localField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">paciente_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">foreignField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">as</span><span class="p">:</span> <span class="dl">"</span><span class="s2">paciente</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="na">$unwind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$paciente</span><span class="dl">"</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="na">$project</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">nome</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$paciente.nome</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">totalRefeicoes</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="na">refeicoesCompletas</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="na">taxaAdesao</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="na">$sort</span><span class="p">:</span> <span class="p">{</span><span class="na">taxaAdesao</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
<span class="p">])</span>
</code></pre></div></div>

<p><strong>Explicação</strong>: Esta consulta:</p>
<ol>
  <li>Agrupa as refeições por paciente, contando o total de refeições e quantas foram completas</li>
  <li>Calcula a taxa de adesão (refeições completas / total de refeições)</li>
  <li>Filtra apenas os pacientes com taxa de adesão abaixo de 0,8 (80%)</li>
  <li>Busca os dados do paciente na coleção <code class="language-plaintext highlighter-rouge">patients</code></li>
  <li>Projeta os campos desejados e ordena por taxa de adesão</li>
</ol>

<p><strong>Resultado</strong>: <a href="../resultados/mongo_consulta_5.png">Veja a imagem do resultado</a></p>

<h2 id="6-rastrear-progresso-corporal-de-um-paciente">6. Rastrear progresso corporal de um paciente</h2>

<p><strong>Objetivo</strong>: Analisar a evolução das medidas corporais de um paciente ao longo do tempo.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">measurements</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
    <span class="p">{</span><span class="na">paciente_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    <span class="p">{</span><span class="na">data</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">peso</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">imc</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">gordura_corporal</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="dl">"</span><span class="s2">medidas.cintura</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">_id</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="p">).</span><span class="nx">sort</span><span class="p">({</span><span class="na">data</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</code></pre></div></div>

<p><strong>Explicação</strong>: Esta consulta recupera todas as medidas corporais do paciente com ID 1, incluindo a medida de cintura que está aninhada no objeto <code class="language-plaintext highlighter-rouge">medidas</code>. Os resultados são ordenados por data.</p>

<p><strong>Resultado</strong>: <a href="../resultados/mongo_consulta_6.png">Veja a imagem do resultado</a></p>

<h2 id="7-encontrar-alimentos-mais-recomendados-nos-planos-alimentares">7. Encontrar alimentos mais recomendados nos planos alimentares</h2>

<p><strong>Objetivo</strong>: Identificar quais alimentos são mais frequentemente recomendados nos planos alimentares.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">dietPlans</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="na">$unwind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$alimentos_recomendados</span><span class="dl">"</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="na">$group</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">_id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$alimentos_recomendados</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">contagem</span><span class="p">:</span> <span class="p">{</span><span class="na">$sum</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="na">$lookup</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">from</span><span class="p">:</span> <span class="dl">"</span><span class="s2">foods</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">localField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">foreignField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">as</span><span class="p">:</span> <span class="dl">"</span><span class="s2">alimento</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="na">$unwind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$alimento</span><span class="dl">"</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="na">$project</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">nome</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$alimento.nome</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">grupo</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$alimento.grupo</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">recomendacoes</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$contagem</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">_id</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="na">$sort</span><span class="p">:</span> <span class="p">{</span><span class="na">recomendacoes</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}}</span>
<span class="p">])</span>
</code></pre></div></div>

<p><strong>Explicação</strong>: Esta consulta:</p>
<ol>
  <li>Desempacota o array <code class="language-plaintext highlighter-rouge">alimentos_recomendados</code> de cada plano alimentar</li>
  <li>Agrupa por ID de alimento e conta quantas vezes cada alimento aparece</li>
  <li>Busca os detalhes de cada alimento na coleção <code class="language-plaintext highlighter-rouge">foods</code></li>
  <li>Projeta os campos desejados e ordena por número de recomendações em ordem decrescente</li>
</ol>

<p><strong>Resultado</strong>: <a href="../resultados/mongo_consulta_7.png">Veja a imagem do resultado</a></p>

<h2 id="8-analisar-comunicação-entre-nutricionistas-e-pacientes">8. Analisar comunicação entre nutricionistas e pacientes</h2>

<p><strong>Objetivo</strong>: Visualizar todas as mensagens trocadas entre nutricionistas e pacientes.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
    <span class="p">{</span>
        <span class="na">$lookup</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">from</span><span class="p">:</span> <span class="dl">"</span><span class="s2">nutritionists</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">localField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">de_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">foreignField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">as</span><span class="p">:</span> <span class="dl">"</span><span class="s2">nutricionista_de</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="na">$lookup</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">from</span><span class="p">:</span> <span class="dl">"</span><span class="s2">patients</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">localField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">de_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">foreignField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">as</span><span class="p">:</span> <span class="dl">"</span><span class="s2">paciente_de</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="na">$lookup</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">from</span><span class="p">:</span> <span class="dl">"</span><span class="s2">nutritionists</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">localField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">para_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">foreignField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">as</span><span class="p">:</span> <span class="dl">"</span><span class="s2">nutricionista_para</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="na">$lookup</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">from</span><span class="p">:</span> <span class="dl">"</span><span class="s2">patients</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">localField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">para_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">foreignField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">as</span><span class="p">:</span> <span class="dl">"</span><span class="s2">paciente_para</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="na">$project</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">remetente</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">$cond</span><span class="p">:</span> <span class="p">{</span>
                    <span class="na">if</span><span class="p">:</span> <span class="p">{</span><span class="na">$eq</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">$de_tipo</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">nutricionista</span><span class="dl">"</span><span class="p">]},</span>
                    <span class="na">then</span><span class="p">:</span> <span class="p">{</span><span class="na">$arrayElemAt</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">$nutricionista_de.nome</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">]},</span>
                    <span class="na">else</span><span class="p">:</span> <span class="p">{</span><span class="na">$arrayElemAt</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">$paciente_de.nome</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="na">destinatario</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">$cond</span><span class="p">:</span> <span class="p">{</span>
                    <span class="na">if</span><span class="p">:</span> <span class="p">{</span><span class="na">$eq</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">$para_tipo</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">nutricionista</span><span class="dl">"</span><span class="p">]},</span>
                    <span class="na">then</span><span class="p">:</span> <span class="p">{</span><span class="na">$arrayElemAt</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">$nutricionista_para.nome</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">]},</span>
                    <span class="na">else</span><span class="p">:</span> <span class="p">{</span><span class="na">$arrayElemAt</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">$paciente_para.nome</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="na">data</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="na">hora</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="na">conteudo</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="na">_id</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="na">$sort</span><span class="p">:</span> <span class="p">{</span><span class="na">data</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">hora</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
<span class="p">])</span>
</code></pre></div></div>

<p><strong>Explicação</strong>: Esta consulta complexa:</p>
<ol>
  <li>Junta dados com as coleções <code class="language-plaintext highlighter-rouge">nutritionists</code> e <code class="language-plaintext highlighter-rouge">patients</code> para encontrar os nomes dos remetentes e destinatários</li>
  <li>Usa condições para determinar se o remetente/destinatário é um nutricionista ou paciente</li>
  <li>Projeta os campos desejados e ordena cronologicamente</li>
</ol>

<p><strong>Resultado</strong>: <a href="../resultados/mongo_consulta_8.png">Veja a imagem do resultado</a></p>

<h2 id="9-encontrar-receitas-que-contêm-determinado-ingrediente">9. Encontrar receitas que contêm determinado ingrediente</h2>

<p><strong>Objetivo</strong>: Listar todas as receitas que contêm um alimento específico.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">recipes</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="na">$match</span><span class="p">:</span> <span class="p">{</span><span class="dl">"</span><span class="s2">ingredientes.food_id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">4</span><span class="p">}},</span>
    <span class="p">{</span>
        <span class="na">$lookup</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">from</span><span class="p">:</span> <span class="dl">"</span><span class="s2">foods</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">localField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ingredientes.food_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">foreignField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">as</span><span class="p">:</span> <span class="dl">"</span><span class="s2">alimentos</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="na">$match</span><span class="p">:</span> <span class="p">{</span><span class="dl">"</span><span class="s2">alimentos.nome</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Brócolis</span><span class="dl">"</span><span class="p">}},</span>
    <span class="p">{</span>
        <span class="na">$project</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">nome</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="na">calorias</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="na">dificuldade</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="na">tempo_preparo</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="na">_id</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">])</span>
</code></pre></div></div>

<p><strong>Explicação</strong>: Esta consulta:</p>
<ol>
  <li>Filtra receitas que têm um ingrediente com <code class="language-plaintext highlighter-rouge">food_id</code> igual a 4</li>
  <li>Busca os detalhes dos alimentos na coleção <code class="language-plaintext highlighter-rouge">foods</code></li>
  <li>Filtra novamente para garantir que o alimento seja “Brócolis”</li>
  <li>Projeta os campos desejados</li>
</ol>

<p><strong>Resultado</strong>: <a href="../resultados/mongo_consulta_9.png">Veja a imagem do resultado</a></p>

<h2 id="10-visualizar-próximas-consultas-agendadas">10. Visualizar próximas consultas agendadas</h2>

<p><strong>Objetivo</strong>: Listar todas as consultas futuras agendadas entre pacientes e nutricionistas.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">appointments</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
    <span class="p">{</span><span class="na">$match</span><span class="p">:</span> <span class="p">{</span><span class="na">status</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Agendada</span><span class="dl">"</span><span class="p">}},</span>
    <span class="p">{</span>
        <span class="na">$lookup</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">from</span><span class="p">:</span> <span class="dl">"</span><span class="s2">patients</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">localField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">paciente_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">foreignField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">as</span><span class="p">:</span> <span class="dl">"</span><span class="s2">paciente</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="na">$lookup</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">from</span><span class="p">:</span> <span class="dl">"</span><span class="s2">nutritionists</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">localField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">nutricionista_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">foreignField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">as</span><span class="p">:</span> <span class="dl">"</span><span class="s2">nutricionista</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="na">$unwind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$paciente</span><span class="dl">"</span><span class="p">},</span>
    <span class="p">{</span><span class="na">$unwind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$nutricionista</span><span class="dl">"</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="na">$project</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">paciente</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$paciente.nome</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">nutricionista</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$nutricionista.nome</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">data</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="na">hora</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="na">_id</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="na">$sort</span><span class="p">:</span> <span class="p">{</span><span class="na">data</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">hora</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
<span class="p">])</span>
</code></pre></div></div>

<p><strong>Explicação</strong>: Esta consulta:</p>
<ol>
  <li>Filtra consultas com status “Agendada”</li>
  <li>Busca os dados do paciente e do nutricionista em suas respectivas coleções</li>
  <li>Desempacota os arrays resultantes</li>
  <li>Projeta os campos desejados e ordena cronologicamente</li>
</ol>

<p><strong>Resultado</strong>: <a href="../resultados/mongo_consulta_10.png">Veja a imagem do resultado</a></p>

  </div>
</article>
    </div>
  </main>

  <footer class="site-footer">
    <div class="wrapper">
      <p>Sistema NoSQL para nutricionistas acompanharem a dieta dos seus pacientes, utilizando Neo4j (banco de grafos) e MongoDB (banco de documentos).</p>
      <p>Repositório: <a href="https://github.com/yourusername/sistema-acompanhamento-dietas">GitHub</a></p>
    </div>
  </footer>
</body>
</html>